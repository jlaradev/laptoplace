<app-header></app-header>
<div class="payment-bg">
  <div *ngIf="mostrarOverlayError" class="payment-overlay-error">
    <div class="payment-overlay-content">
      <span class="payment-overlay-icon">&#9888;</span>
      <h2>Transacción rechazada</h2>
      <p>Serás redirigido al carrito...</p>
    </div>
  </div>
  <div *ngIf="mostrarOverlayAprobada" class="payment-overlay-success">
    <div class="payment-overlay-content">
      <span class="payment-overlay-icon">&#10004;</span>
      <h2>Transacción aprobada</h2>
      <p>Serás redirigido al carrito...</p>
    </div>
  </div>
  <div class="payment-flex-container" [class.blur-sm]="mostrarOverlayError">
    <div class="payment-flex-left">
      <div *ngIf="error" class="payment-error">{{ error }}</div>
      <div #paymentForm id="payment-form"></div>
    </div>
    <div class="payment-flex-right-wrapper">
      <div class="payment-flex-right" *ngIf="items.length > 0">
        <h2 class="payment-summary-title">Resumen del pedido</h2>
        <ul>
          <li *ngFor="let item of items">
            <img *ngIf="item.imagenUrl" [src]="item.imagenUrl" width="40" height="40"
              style="vertical-align:middle;margin-right:8px;" />
            {{ item.nombre }} x {{ item.cantidad }} — ${{ item.precio }}
          </li>
        </ul>
        <div class="font-bold mt-2">Total: ${{ total }}</div>
      </div>
      <button
        class="px-6 py-2 bg-green-600 text-white rounded font-semibold shadow hover:bg-green-700 transition mt-6 w-full payment-confirm-btn"
        [disabled]="loading"
        (click)="confirmarPago()"
        *ngIf="clientSecret && items.length > 0"
      >
        {{ loading ? 'Procesando pago...' : 'Confirmar pago' }}
      </button>
    </div>
  </div>
</div>
<app-footer></app-footer>